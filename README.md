# Multivariate Stochastic Volatility Model

[![Coverage](https://codecov.io/gh/madskoefoed/MultivariateStochasticVolatility.jl/branch/master/graph/badge.svg)](https://codecov.io/gh/madskoefoed/TVVAR.jl)
[![Coverage](https://coveralls.io/repos/github/madskoefoed/MultivariateStochasticVolatility.jl/badge.svg?branch=master)](https://coveralls.io/github/madskoefoed/MultivariateStochasticVolatility.jl?branch=master)


The package estimates a multivariate stochastic volatility model (MVSV) by casting it into a state-space model. The volatility is assumed to follow a random walk. The package is based on the paper _Forecasting with time-varying vector autoregressive models, K. Triantafyllopoulus (2008)_.

Assuming that the time series is generated by:

$$\begin{aligned}
y_{t} = \Phi_{t} + \epsilon_{t} \\
\end{aligned}$$

where

$$\begin{aligned}
\epsilon_{t} \sim N_{p}(0, \Sigma_{t}) \\
\end{aligned}$$

The $p \times p$ covariance matrix $\Sigma_{t}$ is assumed to be symmetric positive-definite and follows:

$$\begin{aligned}
\Sigma_{t}^{-1} = k \Gamma(\Sigma_{t-1}^{-1})' B_{t} \Gamma(\Sigma_{t-1}^{-1}) \\
\end{aligned}$$

where $\Gamma(\Sigma_{t-1}^{-1})$ denotes the upper triangular matrix of the Choleski decomposition of $\Sigma_{t}^{-1}$.

The parameter vector $\Phi_{t}$ is assumed to follow a random walk:

$$\begin{aligned}
\Phi_{t} = \Phi_{t-1} + \Omega_{t} \\
\Omega_{t} \sim N_{p}(0, Q_{t} \times \Sigma_{t}) \\
\end{aligned}$$

The scalar $Q_{t}$ is assumed to 

## Usage
Assume that we have two time series where each has 100 observations ($T=100$) and that we want to estimate a bivariate MVSV, that is $p = 2$. We want to use the first 75 observations to "stabilize" the estimated parameters before updating the model online for the last 25 observations. 

We can simulate the two times series using the package's _simulate_ function. The true parameters will be chosen as:

$$\begin{equation}
\Phi =
\begin{pmatrix} -1 & 2 \\ -0.5 & 0 \\ 0 & 0 \\ 0 & 0 \\ 0 & 0 \\ 0 & 0 \\ 0.3 & 0.8 \end{pmatrix}
\end{equation}$$

This implies that the intercepts are -1 and 2, respectively, for the two time series.

Now we are almost ready to estimate the model. First, however, we need to specfy some hyperparameters and priors.

### Hyperparameters
The hyperparameter $\beta \in [\frac{2}{3};1[$ controls the responsiveness of the covariance matrix while the hyperparameter $\delta \in ]0;1]$ controls the responsiveness of the intercepts.

(1) Set the hyperparameters:

```julia
# Create the struct Hyperparameters
hyperpar = Hyperparameters(0.9, 0.95, 2)
```

### Prior distributions
At time $t=d$ we assume that we know the quantities $m_{d}$, $P_{d}$, and $S_{d}$, whereby we have the prior distributions $\Omega_{d} \sim N_{(dp+1) \ times p}N(m_{d}, P_{d}, \Sigma_{d})$ and $\Sigma_{t}^{-1} \sim W_{p}(n+2p, S_{d})$.
In Triantafyllopoulus (2008) a weakly prior specificion is suggested as $m_{d} = 0_{dp+1 \times p}$, $P_{d} = 1000I_{dp+1}$, and $S_{d} = I_{p}$. We can write this in Julia as:

```julia
# Weakly prior specification
m = zeros(2*3+1, 2)
P = PDMat(Diagonal(1000*ones(2*3+1)))
S = PDMat(Diagonal(ones(2)))

# Create the struct Prior
priors = Priors(m, P, S)
```

### Batch estimation
We want to "batch" estimate the first 75 observations to ensure that the data has been allowed to impact the priors. The package offers a function to do this, but first we need to call _TVVAR_ to create a suitable type.

```julia
# Create struct
tvvar = TVVAR(y[1:75, :], priors)

# "Batch" estimate
estimate_batch!(tvvar)
```

We can plot this (assuming we have the package _Plots_ installed) as follows:
```julia
plot(tvvar.Î¼, lw=1, lc=[:black :red], label="")
scatter!(y_example, lw=3, mc=[:black :red], ma=0.5, label=["y1" "y2"])
plot!(legend=:outerbottom, legendcolumn=2)
```

### On-line estimation


```julia
for t in T_example-49:T_example
    predict!(tvvar)
    update!(tvvar, y_example[t, :])
end
```

## Specifications
The package allows the estimation of a variety of models depending on the inputs. The suggested way to use the package is as follows: